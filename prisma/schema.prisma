//Rules to follow//
//Model names should be singular and start with an uppercase letter.
//Field names should be in camelCase.
//Use appropriate data types for each field.
//Define relationships between models using @relation attribute.
// & write in the first model the relation field as an array if one-to-many.

generator client {
  provider     = "prisma-client-js"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

//Models
model User {
  id      Int     @id @default(autoincrement())
  uuid    String  @unique @default(uuid()) @db.Uuid
  name    String
  email   String  @unique
  phone   String?
  address String?

  passwordHash String?
  provider     AuthProvider
  providerId   String?

  profileImageUrl String?
  nidImageUrl     String?

  isEmailVerified Boolean @default(false)
  isPhoneVerified Boolean @default(false)
  isActive        Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  businessInfo  BusinessInfo[]
  linkCreations OrderCreation[]
}

enum AuthProvider {
  EMAIL
  GOOGLE
  FACEBOOK
  GITHUB
}

model BusinessCategory {
  id                   Int            @id @default(autoincrement())
  businessCategoryName String
  businessInfo         BusinessInfo[]
}

enum BusinessTypeEnum {
  WHOLESALE
  RETAIL
}

model BusinessInfo {
  id                     Int              @id @default(autoincrement())
  businessName           String
  businessLogoUrl        String?
  businessType           BusinessTypeEnum
  businessAddress        String
  businessPhone          String?     
  businessEmail          String           @unique
  businessWebsite        String?
  businessTradeLicense   String?
  businessWareHouse      String?
  businessStoreFrontLink String
  //Date
  createdAt              DateTime         @default(now())
  updatedAt              DateTime         @updatedAt
  //businessCategoryID
  businessCategoryId     Int
  businessCategory       BusinessCategory @relation(fields: [businessCategoryId], references: [id])
  //userID
  userId                 Int
  user                   User             @relation(fields: [userId], references: [id])
}

model OrderCreation {
  id                 Int           @id @default(autoincrement())
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  orderDate          DateTime
  deliveryDate       DateTime
  productName        String
  productDescription String
  productPrice       Float
  productQuantity    Int
  customerName       String
  customerEmail      String?
  customerPhone      String
  customerAddress    String
  invoiceNumber      String        @unique
  invoiceUrl         String
  profOfDelivery     String
  //relations
  userId             Int
  user               User          @relation(fields: [userId], references: [id])
  linkCreated        LinkCreated[]
}

model LinkCreated {
  id            Int            @id @default(autoincrement())
  uuid          String         @unique @default(uuid()) @db.Uuid
  link          String
  createdAt     DateTime       @default(now())
  expiry        DateTime
  //Relations
  orderId       Int
  orderCreation OrderCreation  @relation(fields: [orderId], references: [id])
  sellerReview  SellerReview[]
  sellerScores  SellerScore[]
}

enum ReviewEnum {
  COMPLETED_AS_AGREED
  COMPLETED_WITH_ISSUE
  NOT_COMPLETED
}

model SellerReview {
  id          Int         @id @default(autoincrement())
  review      ReviewEnum
  complain    String?
  createdAt   DateTime    @default(now())
  attachment  String?
  //relations
  orderId     Int
  linkCreated LinkCreated @relation(fields: [orderId], references: [id])
  disputes    Disputes[]
}

model Disputes {
  id             Int          @id @default(autoincrement())
  issue          String
  description    String?
  attachment     String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  //relations
  sellerReviewId Int
  sellerReview   SellerReview @relation(fields: [sellerReviewId], references: [id])
}

model SellerScore {
  id            Int         @id @default(autoincrement())
  score         Int
  createdAt     DateTime    @default(now())
  linkCreatedId Int
  linkCreated   LinkCreated @relation(fields: [linkCreatedId], references: [id])
}

model Otp {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  code      String
  expiresAt DateTime
  createdAt DateTime @default(now())
}
